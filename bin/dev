#!/bin/bash
if [ -z "$TMUX" ]; then #start tmux
    cd ~
    tmux new-session -d -n "dotfiles" -s dev
    tmux send-keys "cd dotfiles; nvim .config/nvim/init.vim" Enter
    tmux split-window -h -c "dotfiles"
    tmux send-keys "git status" Enter
    tmux send-keys "cat TODO.md" Enter
    tmux select-pane -t {left}
    tmux new-window -n stf -c "stf"
    tmux send-keys "l" Enter
    tmux -2 attach-session -d
elif [ -e build.sbt ]; then #scala
    tmux rename-window "$(pwd | xargs basename)"
    tmux split-window -h
    tmux send-keys "sbt" Enter "~test" Enter
    tmux select-pane -t {left}
    nvim -c "tabnew | FZF src/test"
elif [ "$1" = "latex" ];then
    tex_file=$(ls *.tex | head -1)
    pdf_file=$(echo "$tex_file" | sed 's/\.tex$/\.pdf/')

    mupdf "$pdf_file" &
    mupdf_pid=$!

    tmux rename-window "$(echo $pdf_file | sed 's/\.pdf$//')"
    tmux split-window -v -d -p 10
    tmux send-keys -t {bottom} "ls \"$tex_file\" | entr -cps \"pdflatex --halt-on-error \\\"$tex_file\\\" && kill -HUP $mupdf_pid\"" Enter

    nvim "$tex_file"

    kill -15 $mupdf_pid &>/dev/null
else
    tmux rename-window "$(pwd | xargs basename)"
    tmux split-window -h -d
    dirty || nvim -c "FZF"
fi
